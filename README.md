# APTrans

APTrans (Anomaly Pattern-guided Transaction) is a tool designed to detect transaction bugs in Relational Database Management Systems (RDBMSs) with high accuracy and efficiency. The tool generates test cases and captures anomalies based on predefined exception patterns. In our study, we applied APTrans to test three widely used databases—MySQL, MariaDB, and OceanBase—leading to the identification of 13 unique transaction bugs.

For more detailed information, please refer to the paper titled **"Anomaly Pattern-guided Transaction Bug Testing in Relational Databases"**.

# Overview

- **Bugs**: A list of the identified bugs.
- **Comparison**: Comparison of results between different methods.
- **SQLancer**: Modifications made to SQLancer for transaction generation.
- **Executor**: Description of the executor and checker components.

# Requirements

- Java 11 or higher
- Maven
- Python

# Usage

- `./generate.sh`: Generate transaction test cases.
- `./test.sh`: Test all databases.

# Configuration

To configure database parameters, update the relevant scripts located in `/executor/db_config.py` and `/sqlancer/src/sqlancer/MainOptions.java`.

# Bugs

Below is the list of transaction bugs identified during testing:

| ID  | Database   | Bug ID        | Link                                                              |
|-----|------------|---------------|-------------------------------------------------------------------|
| 1   | MySQL      | Bug#115978    | [Bug#115978](https://bugs.mysql.com/bug.php?id=115978)            |
| 2   | MySQL      | Bug#117218    | [Bug#117218](https://bugs.mysql.com/bug.php?id=117218)            |
| 3   | MySQL      | Bug#117733    | [Bug#117733](https://bugs.mysql.com/bug.php?id=117733)            |
| 4   | MySQL      | Bug#117797    | [Bug#117797](https://bugs.mysql.com/bug.php?id=117797)            |
| 5   | MySQL      | Bug#117835    | [Bug#117835](https://bugs.mysql.com/bug.php?id=117835)            |
| 6   | MySQL      | Bug#117860    | [Bug#117860](https://bugs.mysql.com/bug.php?id=117860)            |
| 7   | MariaDB    | MDEV-35335    | [MDEV-35335](https://jira.mariadb.org/browse/MDEV-35335?filter=-2)|
| 8   | MariaDB    | MDEV-35464    | [MDEV-35464](https://jira.mariadb.org/browse/MDEV-35464?filter=-2)|
| 9   | MariaDB    | MDEV-36120    | [MDEV-36120](https://jira.mariadb.org/browse/MDEV-36120?filter=-2)|
| 10  | MariaDB    | MDEV-36308    | [MDEV-36308](https://jira.mariadb.org/browse/MDEV-36308?filter=-2)|
| 11  | MariaDB    | MDEV-36330    | [MDEV-36330](https://jira.mariadb.org/browse/MDEV-36330?filter=-2)|
| 12  | MariaDB    | MDEV-36358    | [MDEV-36358](https://jira.mariadb.org/browse/MDEV-36358?filter=-2)|
| 13  | OceanBase  | #2248         | [#2248](https://github.com/oceanbase/oceanbase/issues/2248)        |


# Comparison of Transaction Execution Efficiency
We have counted the number of transactions executed by each method within the same unit of time (1 hour), as shown in the table below:
| Method | Mysql | Mariadb | OceanBase|
|---|---|---|---|
| Troc | 252 | 319 | 294 |
| TxCheck | 188 | 589 |  |
| APTrans | 8424 | 9894 | 8006 |

## Troc Analysis
Troc generates two transactions per batch, but since it uses a method that compares actual results with simulated results to detect bugs, it incurs additional overhead, which reduces the efficiency of transaction execution.

## TxCheck Analysis
TxCheck generates six transactions per batch. The SQL statements generated by TxCheck are the most complex, involving multiple nested subqueries. Moreover, compared to the other two methods, TxCheck performs at least one additional operation to eliminate cyclic dependencies and decouple concurrent transactions during the execution of each batch of transactions. Therefore, its efficiency in executing transactions is slower.

## APTrans Analysis
APTrans generates two transactions per batch. Our transaction generation strategy does not require additional consideration of whether data dependencies that could hinder the execution of the executor exist. At the same time, our trigger-based execution and analysis strategy does not introduce extra computational overhead, resulting in the highest efficiency in executing transactions.




